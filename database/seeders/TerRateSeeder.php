<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\GlobalTerRate;

class TerRateSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // === KATEGORI A ===
        // (PTKP: TK/0, TK/1, K/0)
        $terA = [
            [0, 5400000, 0.00],
            [5400000, 5650000, 0.25],
            [5650000, 5950000, 0.50],
            [5950000, 6300000, 0.75],
            [6300000, 6750000, 1.00],
            [6750000, 7500000, 1.25],
            [7500000, 8550000, 1.50],
            [8550000, 9650000, 1.75],
            [9650000, 10050000, 2.00],
            [10050000, 10350000, 2.25],
            [10350000, 10700000, 2.50],
            [10700000, 11050000, 3.00],
            [11050000, 11600000, 3.50],
            [11600000, 12500000, 4.00],
            [12500000, 13750000, 5.00],
            [13750000, 15100000, 6.00],
            [15100000, 16950000, 7.00],
            [16950000, 19750000, 8.00],
            [19750000, 24150000, 9.00],
            [24150000, 26450000, 10.00],
            [26450000, 28000000, 11.00],
            [28000000, 30050000, 12.00],
            [30050000, 32400000, 13.00],
            [32400000, 35400000, 14.00],
            [35400000, 39100000, 15.00],
            [39100000, 43850000, 16.00],
            [43850000, 47800000, 17.00],
            [47800000, 51400000, 18.00],
            [51400000, 56300000, 19.00],
            [56300000, 62200000, 20.00],
            [62200000, 70600000, 21.00],
            [70600000, 81950000, 22.00],
            [81950000, 98600000, 23.00],
            [98600000, 124750000, 24.00],
            [124750000, 171050000, 25.00],
            [171050000, 276200000, 26.00],
            [276200000, 618500000, 27.00],
            [618500000, 977150000, 28.00],
            [977150000, 1007600000, 29.00],
            [1007600000, 1357550000, 30.00],
            [1357550000, 1419350000, 31.00],
            [1419350000, 3237550000, 32.00],
            [3237550000, 6092950000, 33.00],
            [6092950000, null, 34.00], // Di atas 6M
        ];

        // === KATEGORI B ===
        // (PTKP: TK/2, TK/3, K/1, K/2)
        $terB = [
            [0, 6200000, 0.00],
            [6200000, 6500000, 0.25],
            [6500000, 6850000, 0.50],
            [6850000, 7300000, 0.75],
            [7300000, 7800000, 1.00],
            [7800000, 8650000, 1.25],
            [8650000, 9850000, 1.50],
            [9850000, 11150000, 1.75],
            [11150000, 11600000, 2.00],
            [11600000, 11950000, 2.25],
            [11950000, 12350000, 2.50],
            [12350000, 12800000, 3.00],
            [12800000, 13400000, 3.50],
            [13400000, 14450000, 4.00],
            [14450000, 15900000, 5.00],
            [15900000, 17450000, 6.00],
            [17450000, 19550000, 7.00],
            [19550000, 22750000, 8.00],
            [22750000, 27750000, 9.00],
            [27750000, 30350000, 10.00],
            [30350000, 32150000, 11.00],
            [32150000, 34500000, 12.00],
            [34500000, 37250000, 13.00],
            [37250000, 40750000, 14.00],
            [40750000, 45050000, 15.00],
            [45050000, 50550000, 16.00],
            [50550000, 55100000, 17.00],
            [55100000, 59250000, 18.00],
            [59250000, 64950000, 19.00],
            [64950000, 71750000, 20.00],
            [71750000, 81450000, 21.00],
            [81450000, 94600000, 22.00],
            [94600000, 113900000, 23.00],
            [113900000, 144200000, 24.00],
            [144200000, 196600000, 25.00],
            [196600000, 316900000, 26.00],
            [316900000, 708850000, 27.00],
            [708850000, 1119000000, 28.00],
            [1119000000, 1153100000, 29.00],
            [1153100000, 1553550000, 30.00],
            [1553550000, 1623800000, 31.00],
            [1623800000, 3698200000, 32.00],
            [3698200000, 6960100000, 33.00],
            [6960100000, null, 34.00],
        ];

        // === KATEGORI C ===
        // (PTKP: K/3)
        $terC = [
            [0, 6600000, 0.00],
            [6600000, 6950000, 0.25],
            [6950000, 7350000, 0.50],
            [7350000, 7800000, 0.75],
            [7800000, 8350000, 1.00],
            [8350000, 9300000, 1.25],
            [9300000, 10550000, 1.50],
            [10550000, 11950000, 1.75],
            [11950000, 12450000, 2.00],
            [12450000, 12800000, 2.25],
            [12800000, 13250000, 2.50],
            [13250000, 13750000, 3.00],
            [13750000, 14400000, 3.50],
            [14400000, 15550000, 4.00],
            [15550000, 17100000, 5.00],
            [17100000, 18750000, 6.00],
            [18750000, 21050000, 7.00],
            [21050000, 24450000, 8.00],
            [24450000, 29850000, 9.00],
            [29850000, 32650000, 10.00],
            [32650000, 34600000, 11.00],
            [34600000, 37100000, 12.00],
            [37100000, 40100000, 13.00],
            [40100000, 43850000, 14.00],
            [43850000, 48500000, 15.00],
            [48500000, 54400000, 16.00],
            [54400000, 59350000, 17.00],
            [59350000, 63800000, 18.00],
            [63800000, 69900000, 19.00],
            [69900000, 77250000, 20.00],
            [77250000, 87750000, 21.00],
            [87750000, 101900000, 22.00],
            [101900000, 122750000, 23.00],
            [122750000, 155350000, 24.00],
            [155350000, 211750000, 25.00],
            [211750000, 341350000, 26.00],
            [341350000, 763350000, 27.00],
            [763350000, 1205050000, 28.00],
            [1205050000, 1241750000, 29.00],
            [1241750000, 1673050000, 30.00],
            [1673050000, 1748700000, 31.00],
            [1748700000, 3982750000, 32.00],
            [3982750000, 7495550000, 33.00],
            [7495550000, null, 34.00],
        ];

        // 3. Proses Insert ke Database
        $this->insertBatch('A', $terA);
        $this->insertBatch('B', $terB);
        $this->insertBatch('C', $terC);
    }

    private function insertBatch($category, $data)
    {
        $rows = [];
        foreach ($data as $r) {
            $min = $r[0];
            $max = $r[1];
            
            // LOGIKA PENTING: Tambahkan +1 pada batas bawah (kecuali baris pertama)
            // Agar tidak overlap. Contoh: 5.400.000 (Baris 1) vs 5.400.001 (Baris 2)
            if ($min > 0) {
                $min += 1;
            }

            $rows[] = [
                'ter_category' => $category,
                'gross_income_min' => $min,
                'gross_income_max' => $max,
                'rate_percentage' => $r[2],
                'created_at' => now(),
                'updated_at' => now(),
            ];
        }
        
        GlobalTerRate::insert($rows);
    }
}
