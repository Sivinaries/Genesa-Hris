<?php

namespace Database\Seeders;

use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;
use App\Models\GlobalTerRate;

class TerRateSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        // === KATEGORI A ===
        // (PTKP: TK/0, TK/1, K/0)
        $terA = [
            [0, 5400000, 0.00],
            [5400000, 5650000, 0.25],
            [5650000, 5950000, 0.50],
            [5950000, 6300000, 0.75],
            [6300000, 6750000, 1.00],
            [6750000, 7500000, 1.25],
            [7500000, 8550000, 1.50],
            [8550000, 9650000, 1.75],
            [9650000, 10050000, 2.00],
            [10050000, 10350000, 2.25],
            [10350000, 10700000, 2.50],
            [10700000, 11050000, 3.00],
            [11050000, 11600000, 3.50],
            [11600000, 12500000, 4.00],
            [12500000, 13750000, 5.00],
            [13750000, 15100000, 6.00],
            [15100000, 16950000, 7.00],
            [16950000, 19750000, 8.00],
            [19750000, 24150000, 9.00],
            [24150000, 26450000, 10.00],
            [26450000, 28000000, 11.00],
            [28000000, 30050000, 12.00],
            [30050000, 32400000, 13.00],
            [32400000, 35400000, 14.00],
            [35400000, 39100000, 15.00],
            [39100000, 43850000, 16.00],
            [43850000, 47800000, 17.00],
            [47800000, 51400000, 18.00],
            [51400000, 56300000, 19.00],
            [56300000, 62200000, 20.00],
            [62200000, 6860000, 21.00],
            [6860000, 77500000, 22.00],
            [77500000, 89000000, 23.00],
            [89000000, 103000000, 24.00],
            [103000000, 125000000, 25.00],
            [125000000, 157000000, 26.00],
            [157000000, 206000000, 27.00],
            [206000000, 337000000, 28.00],
            [337000000, 454000000, 29.00],
            [454000000, 550000000, 30.00],
            [550000000, 695000000, 31.00],
            [695000000, 910000000, 32.00],
            [910000000, 1400000000, 33.00],
            [1400000000, null, 34.00],
        ];

        // === KATEGORI B ===
        // (PTKP: TK/2, TK/3, K/1, K/2)
        $terB = [
            [0, 6200000, 0.00],
            [6200000, 6500000, 0.25],
            [6500000, 6850000, 0.50],
            [6850000, 7300000, 0.75],
            [7300000, 9200000, 1.00],
            [9200000, 10750000, 1.50],
            [10750000, 11250000, 2.00],
            [11250000, 11600000, 2.50],
            [11600000, 12600000, 3.00],
            [12600000, 13600000, 4.00],
            [13600000, 14950000, 5.00],
            [14950000, 16400000, 6.00],
            [16400000, 18450000, 7.00],
            [18450000, 21850000, 8.00],
            [21850000, 26000000, 9.00],
            [26000000, 27700000, 10.00],
            [27700000, 29350000, 11.00],
            [29350000, 31450000, 12.00],
            [31450000, 33950000, 13.00],
            [33950000, 37100000, 14.00],
            [37100000, 41100000, 15.00],
            [41100000, 45800000, 16.00],
            [45800000, 49500000, 17.00],
            [49500000, 53800000, 18.00],
            [53800000, 58500000, 19.00],
            [58500000, 64000000, 20.00],
            [64000000, 71000000, 21.00],
            [71000000, 80000000, 22.00],
            [80000000, 93000000, 23.00],
            [93000000, 109000000, 24.00],
            [109000000, 129000000, 25.00],
            [129000000, 163000000, 26.00],
            [163000000, 211000000, 27.00],
            [211000000, 374000000, 28.00],
            [374000000, 459000000, 29.00],
            [459000000, 555000000, 30.00],
            [555000000, 704000000, 31.00],
            [704000000, 957000000, 32.00],
            [957000000, 1405000000, 33.00],
            [1405000000, null, 34.00],
        ];

        // === KATEGORI C ===
        // (PTKP: K/3)
        $terC = [
            [0,        6600000,    0.00],
            [6600000,  6950000,    0.25],
            [6950000,  7350000,    0.50],
            [7350000,  7800000,    0.75],
            [7800000,  8850000,    1.00],
            [8850000,  9800000,    1.25],
            [9800000,  10950000,   1.50],
            [10950000, 11200000,   1.75],
            [11200000, 12050000,   2.00],
            [12050000, 12950000,   3.00],
            [12950000, 14150000,   4.00],
            [14150000, 15550000,   5.00],
            [15550000, 17050000,   6.00],
            [17050000, 19500000,   7.00],
            [19500000, 22700000,   8.00],
            [22700000, 26600000,   9.00],
            [26600000, 28100000,  10.00],
            [28100000, 30100000,  11.00],
            [30100000, 32600000,  12.00],
            [32600000, 35400000,  13.00],
            [35400000, 38900000,  14.00],
            [38900000, 43000000,  15.00],
            [43000000, 47400000,  16.00],
            [47400000, 51200000,  17.00],
            [51200000, 55800000,  18.00],
            [55800000, 60400000,  19.00],
            [60400000, 66700000,  20.00],
            [66700000, 74500000,  21.00],
            [74500000, 83200000,  22.00],
            [83200000, 95600000,  23.00],
            [95600000, 110000000, 24.00],
            [110000000,134000000, 25.00],
            [134000000,169000000, 26.00],
            [169000000,221000000, 27.00],
            [221000000,390000000, 28.00],
            [390000000,463000000, 29.00],
            [463000000,561000000, 30.00],
            [561000000,709000000, 31.00],
            [709000000,965000000, 32.00],
            [965000000,1419000000,33.00],
            [1419000000,null,      34.00],
        ];

        // 3. Proses Insert ke Database
        $this->insertBatch('A', $terA);
        $this->insertBatch('B', $terB);
        $this->insertBatch('C', $terC);
    }

    private function insertBatch($category, $data)
    {
        $rows = [];
        foreach ($data as $r) {
            $min = $r[0];
            $max = $r[1];
            
            // LOGIKA PENTING: Tambahkan +1 pada batas bawah (kecuali baris pertama)
            // Agar tidak overlap. Contoh: 5.400.000 (Baris 1) vs 5.400.001 (Baris 2)
            if ($min > 0) {
                $min += 1;
            }

            $rows[] = [
                'ter_category' => $category,
                'gross_income_min' => $min,
                'gross_income_max' => $max,
                'rate_percentage' => $r[2],
                'created_at' => now(),
                'updated_at' => now(),
            ];
        }
        
        GlobalTerRate::insert($rows);
    }
}